---
createdAt: 2025-03-31_T07:52:41
literatureNote: "[[Amazon VPCを「これでもか！」というくらい丁寧に解説]]"
fleetingNote: 
tags:
  - VPS
  - AWS
---
# VPCとは

VPC = Virtual Private Cloud
	→クラウド上に仮想的なネットワークを構築するためのサービス

# VPCのメリット

AWSでは独自ネットワークを構築しなくても個別の通信が可能
	→この方式ではセキュリティ、性能面で制御が難しい
これに対しVPCを利用することで
- 通信経路を絞って監視、アクセス制御を行うことでセキュリティを向上
- 通信経路を明示的に制御してロードバランサ等でスケールアウトすることで性能を担保
- 通信経路を明示的に複数確保することで可用性を向上
- システム内のサービスを整理して一括管理することで、運用・保守性を向上
- IcCサービスと組み合わせることで移行性を向上
→非機能案件の担保につながる

# VPCの役割

非機能案件(IPA定義)
- 可用性 → 必要な時にいつでもサービスが提供、停止していない
- 性能・拡張性 → 必要な速度が確保されている&利用者が増えても拡張できる
- 運用・保守性 → 運用監視や問題発生時の対応を適切に行える
- 移行性 → 新環境への移行の容易性
- セキュリティ → 不正アクセスを防止する
- システム環境・エコロジー → システムの設置環境や、自然環境に与える影響

# オンプレにおけるネットワーク設計の難しさ

上記要件を満たすために、高度なネットワーク機器の知識、機器を揃えるためのコストが必要となる

EX.) 可用性の向上のためにサーバ、回線を冗長化した上で自動でバックアップに切り替えるための設定(リンクアグリゲーション等)を実施する必要がある

# AWSのネットワーク設計上のメリット

可用性,セキュリティ向上のための施策がデータセンターに組み込まれている
→デフォルト状態でもある程度高い非機能要件が確保

加えて非機能要件を向上させるためのサービスが多数準備されている
→組み合わせるだけで高度な非機能要件も実現可能

**専門機器の購入,ハードの知識が不要
→小規模組織でも適切な非機能要件を実現しやすい**

VPC:これらのサービスどうしをネットワークでつなぐ基盤となるため正しい知識の会得は不可欠

# AWSにおけるネットワーク関連サービス

| サービス名            | 非機能要件                     | 概要                                                                    |
| ---------------- | ------------------------- | --------------------------------------------------------------------- |
| ELB              | 可用性</br>性能・拡張性            | ロードバランサによる過負荷防止                                                       |
| Cloud Front      | 可用性 </br>性能・拡張性           | [[CDN]]によるアクセス速度向上と過負荷防止                                              |
| Route 53         | 可用性</br>性能・拡張性</br>セキュリティ | [[ヘルスチェック]]による可用性向上,[[DNSラウンドロビン]]による拡張性向上,[[DNSファイアウォール]]によるセキュリティ向上 |
| Network Firewall | セキュリティ                    | サブネットに対するアクセスルールを設定する                                                 |
| WAF              | セキュリティ                    | Webアプリに対する一般的な攻撃パターンをブロックする                                           |
| Direct Connect   | セキュリティ                    | 専用線接続によるセキュリティ向上                                                      |

# VPCの仕組みと主要機能

## ネットワークの基礎知識

### IPアドレス

| 階層  | 名称        | 通信相手の識別に使用する情報 |
| --- | --------- | -------------- |
| 第7層 | アプリケーション層 | プロトコルによりことなる   |
| 第4層 | トランスポート層  | ポート番号          |
| 第3層 | ネットワーク層   | IPアドレス         |
| 第2層 | データリンク層   | MACアドレス        |
| 第1層 | 物理層       | 物理的な接続         |
※第5層(セッション層),第6層(プレゼンテーション層)はTCP/IPではアプリケーション層と一体化されるため省略

### IPアドレスの構造

32ビットの数値で表されるIPv4と128ビットの数値で表されるIPv6が存在

### Global IP, Private IP

#### Global IP Address
	世界中で一意に定められるIPアドレスで、インターネット経由でのアクセスに用いられる。
	AWSにおいてはパブリックIPアドレスとも。

#### Private IP Address
	限られた範囲内で用いられ、その範囲内のみ一意に定める必要がある(範囲外では重複が許される)IPアドレス

### ネットワーク部とホスト部

32BitのIPv4アドレスであれば、上位XBitのネットワーク部と下位32-XBitのホスト部に分かれる

EX.) 192.168.1.2

|       | 10進数表記      | 2進数表記                               |
| ----- | ----------- | ----------------------------------- |
| IP全体  | 192.168.1.2 | 11000000 10101000 00000001 00000010 |
| NW部   | 192.168.1   | 110000001010100000000001            |
| Host部 | 2           | 00000010                            |

ネットワーク部を1、ホスト部を0Bit表記したものをサブネットマスクという。

EX.) ネットワーク部が24Bitであれば、サブネットマスクは
	255.255.255.0(11111111 11111111 11111111 00000000)

ネットワーク部の長さは、サブネットマスク長,プレフィックス長と呼ばれる。
ホスト部をすべて0で埋めたアドレスはネットワークアドレスと呼ばれ、サブネット自身を表すアドレスとして使用される。

### サブネット

通常、プライベートIPアドレスのプレフィックス長が クラスA~Cの固定値(8,16,24Bit)が使用される。
→3通りのプレフィックス長しか使用できないため、ホスト数によってはアドレス空間が大量に余ってしまい、無駄の多いネットワークとなってしまう。

⇒3通り意外のプレフィックス長が動的に設定できるようにしたCIDR(Classless Inter-Domain Routing)と呼ばれる機構が広く使われている

#### CIDR記法
192.168.1.2のNW部が26Bitであればネットワークアドレスは192.168.1.0/26と表す。

### 使用可能なIPアドレス

ICANNによって使用できるアドレス反意